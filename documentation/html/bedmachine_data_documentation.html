
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>bedmachine_data documentation</title><meta name="generator" content="MATLAB 9.7"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-01-25"><meta name="DC.source" content="bedmachine_data_documentation.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1><tt>bedmachine_data</tt> documentation</h1><!--introduction--><p><tt>bedmachine_data</tt> loads data from Morlighem et al.'s <a href="http://sites.uci.edu/morlighem/dataproducts/">BedMachine datasets</a>.</p><p>See also  <a href="bedmachine_documentation.html"><tt>bedmachine</tt></a>, <a href="bedmachine_interp_documentation.html"><tt>bedmachine_interp</tt></a> and <a href="bedmachine_profile_documentation.html"><tt>bedmachine_profile</tt></a>.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Requirements</a></li><li><a href="#2">Syntax</a></li><li><a href="#3">Description</a></li><li><a href="#4">Example 1: Simplest case</a></li><li><a href="#5">Example 2: Making the full continent manageable</a></li><li><a href="#8">Example: Jakobshavn Glacier:</a></li><li><a href="#13">Citing this dataset</a></li><li><a href="#14">Author Info</a></li></ul></div><h2 id="1">Requirements</h2><p>This function requires a set of Matlab tools and a Bedmachine dataset, and both will depend on where you're working. Get them here:</p><div><ul><li><b>For Greenland:</b></li></ul></div><div><ol><li><a href="https://www.mathworks.com/matlabcentral/fileexchange/63324">Arctic Mapping Tools</a></li><li><a href="https://nsidc.org/data/IDBMG4">Greenland Bedmachine Data</a></li></ol></div><div><ul><li><b>For Antarctica:</b></li></ul></div><div><ol><li><a href="https://www.mathworks.com/matlabcentral/fileexchange/47638">Antarctic Mapping Tools</a></li><li><a href="https://nsidc.org/data/nsidc-0756">Antarctic Bedmachine Data</a></li></ol></div><h2 id="2">Syntax</h2><pre>Z = bedmachine_data(variable)
Z = bedmachine_data(variable,lati,loni)
Z = bedmachine_data(variable,xi,yi)
Z = bedmachine_data(...,'buffer',extrakm)
Z = bedmachine_data(...,IceSheet)
Z = bedmachine_data(...,'datum',datum)
[Z,x,y] = bedmachine_data(...)
[Z,Lat,Lon] = bedmachine_data(...,'geo')
[~,x,y] = bedmachine_data(outline)
[~,lat,lon] = bedmachine_data(outline,'geo')</pre><h2 id="3">Description</h2><p><tt>Z = bedmachine_data(variable)</tt> loads a specified variable for the whole ice sheet, with elevations relative to the EIGEN-EC4 geoid. The <tt>variable</tt> can be:</p><div><ul><li><tt>'mask'</tt>      0 = ocean, 1 = ice-free land, 2 = grounded ice, 3 = floating ice, 4 = non-Greenland land</li><li><tt>'surface'</tt>   meters relative to EIGEN-EC4 geoid.</li><li><tt>'thickness'</tt> meters</li><li><tt>'bed'</tt>       meters relative to EIGEN-EC4 geoid.</li><li><tt>'errbed'</tt>    meters</li><li><tt>'source'</tt>    Greenland: 0 = none, 1 = gimpdem, 2 = Mass conservation, 3 = synthetic, 4 = interpolation, 5 = hydrostatic equilibrium, 6 = kriging, 7 = RTOPO-2, 8 = gravity inversion, 10+ = bathymetry data)</li><li><tt>'source'</tt>    Antarctic: 1 = REMA/IBCSO, 2 = Mass conservation, 3 = interpolation, 4 = hydrostatic, 5 = Kriging, 6 = gravity inversion</li><li><tt>'geoid'</tt>     meters above WGS84 ellipsoid</li><li><tt>'base'</tt>      meters base of the ice sheet (bottom of ice shelves, but same as bed over grounded ice.)</li><li><tt>'wct'</tt>       meters water column thickness (derived, not an official BedMachine product.)</li><li><tt>'taf'</tt>       meters thickness above flotation (derived, not an official BedMachine product.)</li><li><tt>'flex'</tt>      dimensionless coefficient of tidal flexure (can slightly exceed 1; see Vaughan 1995 or Holdsworth 1969; derived, not an official BedMachine product; Requires Image Processing Toolbox. )</li><li><tt>'head'</tt>      meters freshwater equivalent, static pressure head (derived, not an official BedMachine product.)</li></ul></div><p><tt>Z = bedmachine_data(variable,lati,loni)</tt> returns only enough BedMachine data to fully encompass a set of points given by geo coordinates <tt>lati,loni</tt>. This is a good way to save computer memory, only loading, analyzing, and plotting the data you need to work in a region of interest.</p><p><tt>Z = bedmachine_data(variable,xi,yi)</tt> As above, but for polar stereographic coordinates <tt>xi,yi</tt> in meters (ps70 for Greenland; ps71 for Antarctica). The function automatically determines whether input coordinates are geo or polar stereographic via the <tt>islatlon</tt> function.</p><p><tt>Z = bedmachine_data(...,'buffer',extrakm)</tt> as above, but adds a buffer around the input coordinates. This option is useful for loading only the data in your region of interest, plus a little extra around the sides for good measure.</p><p><tt>Z = bedmachine_data(...,IceSheet)</tt> specifies either <tt>'greenland'</tt> or <tt>'antarctica'</tt> (default).</p><p><tt>Z = bedmachine_data(...,'datum',datum)</tt> specifies a datum as either <tt>'geoid'</tt> (default) or <tt>'ellipsoid'</tt> for wgs84.</p><p><tt>[Z,x,y] = bedmachine_data(...,'xy')</tt> returns polar stereographic meters (ps70 for Greenland; ps71 for Antarctica) as 1d arrays x,y.</p><p><tt>[Z,Lat,Lon] = bedmachine_data(...,'geo')</tt> returns gridded geo coordinates corresponding to each pixel in <tt>Z</tt>.</p><p><tt>[x,y] = bedmachine_data(outline)</tt> gives the (derived) polar stereographic coordinates of any of these outlines:</p><div><ul><li><tt>'gl'</tt>      grounding line</li><li><tt>'coast'</tt>   coast line</li><li><tt>'hl'</tt>      approximate hydrostatic line given by flex=0.99.</li></ul></div><p><tt>[lat,lon] = bedmachine_data(outline,'geo')</tt> as above, but returns geographic coordinates.</p><h2 id="4">Example 1: Simplest case</h2><p>The simplest way to load BedMachine data is to just specify which variable you want to load, like this:</p><pre class="codeinput">bed = bedmachine_data(<span class="string">'bed'</span>);
imagesc(bed);
</pre><img vspace="5" hspace="5" src="bedmachine_data_documentation_01.png" alt=""> <h2 id="5">Example 2: Making the full continent manageable</h2><p>But of course you'll want to know where those points belong on the map so get the polar stereographic coordinates like this:</p><pre class="codeinput">[bed,x,y] = bedmachine_data(<span class="string">'bed'</span>,<span class="string">'greenland'</span>);
</pre><p>You may find that the full continent of data at the native 500 m resolution is rather unwieldy to work with. Simply loading the nearly 200 million data points takes several seconds on my ancient laptop.</p><p>If you're making a map of the whole continent, keep in mind that Greenland's 18,000 by 10,000 points is more pixels than can possibly be displayed on any modern computer screen, so we can probably do just fine if we scale down the full dataset by a factor of 10, and still get a high-res image of the ice sheet.</p><p>To downscale the dataset I recommend <tt>imresize</tt>, which is a standard Matlab function and it performs antialiasing before downscaling. Here's what it looks like if we downscale the whole continent by a factor of 10. Instead of the default parula colormap I'm using <a href="https://www.mathworks.com/matlabcentral/fileexchange/68546">Fabio Crameri's topographic colormap</a>, which is perceptually uniform and draws a clear distinction between regions above and below sea level.</p><pre class="codeinput">sc = 0.1; <span class="comment">% scale for resizing the grid</span>
imagesc(imresize(x,sc),imresize(y,sc),imresize(bed,sc))
axis <span class="string">xy</span> <span class="string">image</span> <span class="string">off</span>
caxis([-1 1]*2500)
cmocean <span class="string">topo</span>
greenland(<span class="string">'k'</span>) <span class="comment">% adds a black grounding line</span>
</pre><img vspace="5" hspace="5" src="bedmachine_data_documentation_02.png" alt=""> <p>Add a little relief shading if you like:</p><pre class="codeinput">shadem(3,[225 80])
</pre><img vspace="5" hspace="5" src="bedmachine_data_documentation_03.png" alt=""> <h2 id="8">Example: Jakobshavn Glacier:</h2><p>The BedMachine datasets are quite large. The Greenland and Antarctic datasets each have about 200 million grid cells. If you're focused on a small region you'll find it's much faster and uses much less computer memory if you only load the data you need. Here we'll load all the data around Jakobshavn Glacier.</p><p>Jakobshavn Glacier is located at (69.167 N,49.833 W). Load all the Bedmachine data centered on that location, plus 75 km of data on each side and 150 km of data on top and bottom, to make a final grid size of 150 km by 300 km:</p><pre class="codeinput">[Z,Lat,Lon] = bedmachine_data(<span class="string">'surface'</span>,69.167,-49.833,<span class="string">'buffer'</span>,[75 150],<span class="string">'geo'</span>);

figure
pcolorpsn(Lat,Lon,Z)
axis <span class="string">tight</span>
scalebarpsn(<span class="string">'location'</span>,<span class="string">'se'</span>)
textpsn(69.167,-49.833,<span class="string">'Jakobshavn Gl.'</span>,<span class="string">'fontangle'</span>,<span class="string">'italic'</span>)
shadem(2,[225 60]) <span class="comment">% applies hillshade</span>
mapzoompsn(<span class="string">'ne'</span>)   <span class="comment">% creates an inset map</span>
[C,h] = contourpsn(Lat,Lon,Z,<span class="string">'color'</span>,.5*[1 1 1]); <span class="comment">% adds contour lines</span>
clabel(C,h,<span class="string">'labelspacing'</span>,1e3,<span class="string">'color'</span>,.3*[1 1 1],<span class="string">'fontsize'</span>,8)
</pre><img vspace="5" hspace="5" src="bedmachine_data_documentation_04.png" alt=""> <p>Sometimes your region of interest is best defined by where you have data. For example, you're interested in the ice basin that drains through Moscow University Ice Shelf. Load the Moscow basin data using <a href="https://www.mathworks.com/matlabcentral/fileexchange/60246"><tt>antbounds_data</tt></a>.</p><pre class="codeinput">[lat,lon] = basin_data(<span class="string">'imbie refined'</span>,<span class="string">'Moscow'</span>);

figure
plotps(lat,lon,<span class="string">'r'</span>)
</pre><img vspace="5" hspace="5" src="bedmachine_data_documentation_05.png" alt=""> <p>Now for whatever type of analysis you're doing, perhaps you decide you just want all the bed elevation data in the Moscow ice basin, plus about 25 km on all sides for good measure. Here's how to load just enough data to encompass your <tt>lat,lon</tt> dataset (the basin boundaries in this case) and add a 25 km buffer around it:</p><pre class="codeinput">[bed,x,y] = bedmachine_data(<span class="string">'bed'</span>,lat,lon,<span class="string">'antarctica'</span>,<span class="keyword">...</span>
   <span class="string">'buffer'</span>,25,<span class="string">'datum'</span>,<span class="string">'ellipsoid'</span>);

imagesc(x,y,bed)
axis <span class="string">xy</span> <span class="string">image</span> <span class="comment">% orients axis correctly &amp; removes whitespace</span>
hold <span class="string">on</span>
plotps(lat,lon,<span class="string">'r'</span>) <span class="comment">% plots basin outline</span>
cb = colorbar;
ylabel(cb,<span class="string">'bed elevation (m wrt WGS84)'</span>)
mapzoomps(<span class="string">'sw'</span>)
caxis([-2200 1000])
</pre><img vspace="5" hspace="5" src="bedmachine_data_documentation_06.png" alt=""> <p>Now that's the bed elevation data with respect to WGS84 and it looks decent. However, I'd like to point out what can be learned by playing with hillshade. With any gridded dataset, I always recommend calling <tt>shadem('ui')</tt>, which starts a user interface, letting you click around on the map to change light angles, or press up the up and down keys to change the exaggeration of the effect. Here are some <tt>shadem</tt> settings that look okay for this map. Also I'm gonna set the colormap to the <tt>cmocean</tt> topographic color scheme, using the <tt>'pivot'</tt> option to ensure the zero point is at zero elevation.</p><pre class="codeinput">shadem(2,[225 80])
cmocean(<span class="string">'topo'</span>,<span class="string">'pivot'</span>)
</pre><img vspace="5" hspace="5" src="bedmachine_data_documentation_07.png" alt=""> <p>In the map above, you might notice some interesting features that appear after adding <tt>shadem</tt>. Note the pearl-necklace patterns that radiate outward from Casey Station (beyond the right edge of the map). Those patterns are instantly recognizable as a gridding effect that results when survey flight lines are sparse. The surface may be locally overfit close to the flight lines, but the large smooth areas between flight lines get smeared out because no data are available to constrain the gridding.</p><p>The necklace effects we see in the map above do not indicate that anything went wrong with the gridding process, but do give you an idea of where we actually have ice thickness data, and where things have been filled in by interpolation.</p><p>Now, just as a fun exercise, let's load BedMachine surface data and plot it as contour lines every 500 m, but only plot contours within the bounds of the Moscow University Ice Shelf basin. We'll also do someting slightly different to load the data this time--instead of entering the geo coordinates of the basin outline and specifying a buffer distance, we can just load enough data to fill the axis limits of the map above, using <tt>xlim</tt> and <tt>ylim</tt>. Here's how:</p><pre class="codeinput"><span class="comment">% Load surface data:</span>
[sfz,LAT,LON] = bedmachine_data(<span class="string">'surface'</span>,xlim,ylim,<span class="string">'antarctica'</span>,<span class="keyword">...</span>
   <span class="string">'datum'</span>,<span class="string">'ellipsoid'</span>,<span class="string">'geo'</span>);

<span class="comment">% Mask out surface data outside the basin:</span>
sfz(~inbasin(LAT,LON,<span class="string">'imbie refined'</span>,<span class="string">'moscow'</span>)) = nan;

<span class="comment">% Plot and label contour lines:</span>
[C,h] = contourps(LAT,LON,sfz,0:500:10000,<span class="string">'k'</span>);
clabel(C,h,<span class="string">'labelspacing'</span>,1e3)
caxis([-2200 1000])
</pre><img vspace="5" hspace="5" src="bedmachine_data_documentation_08.png" alt=""> <h2 id="13">Citing this dataset</h2><p>If you use BedMachine data, please cite the Morlighem paper listed below. And if this function is useful for you, please do me a kindness and cite my Antarctic Mapping Tools paper.</p><p>Morlighem M. et al., (2017), BedMachine v3: Complete bed topography and ocean bathymetry mapping of Greenland from multi-beam echo sounding combined with mass conservation, <i>Geophys. Res. Lett.</i>, 44, <a href="http://doi.org/10.1002/2017GL074954">doi:10.1002/2017GL074954</a>.</p><p>Morlighem, M., E. Rignot, T. Binder, D. D. Blankenship, R. Drews, G. Eagles, O. Eisen, F. Ferraccioli, R. Forsberg, P. Fretwell, V. Goel, J. S. Greenbaum, H. Gudmundsson, J. Guo, V. Helm, C. Hofstede, I. Howat, A. Humbert, W. Jokat, N. B. Karlsson, W. Lee, K. Matsuoka, R. Millan, J. Mouginot, J. Paden, F. Pattyn, J. L. Roberts, S. Rosier, A. Ruppel, H. Seroussi, E. C. Smith, D. Steinhage, B. Sun, M. R. van den Broeke, T. van Ommen, M. van Wessem, and D. A. Young. 2019. Deep glacial troughs and stabilizing ridges unveiled beneath the margins of the Antarctic ice sheet, Nature Geoscience. <a href="https://doi.org/10.1038/s41561-019-0510-8">doi:10.1016/j.cageo.2016.08.003</a>.</p><p>Greene, C. A., Gwyther, D. E., &amp; Blankenship, D. D. Antarctic Mapping Tools for Matlab. <i>Computers &amp; Geosciences</i>. 104 (2017) pp.151-157. <a href="http://dx.doi.org/10.1016/j.cageo.2016.08.003">doi:10.1016/j.cageo.2016.08.003</a>.</p><h2 id="14">Author Info</h2><p>This function and supporting documentation were written by Chad A. Greene of the University of Texas at Austin, October 2018.</p><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019b</a><br></p></div><!--
##### SOURCE BEGIN #####
%% |bedmachine_data| documentation
% |bedmachine_data| loads data from Morlighem et al.'s <http://sites.uci.edu/morlighem/dataproducts/ BedMachine datasets>.
% 
% See also  <bedmachine_documentation.html |bedmachine|>, <bedmachine_interp_documentation.html |bedmachine_interp|> and 
% <bedmachine_profile_documentation.html |bedmachine_profile|>.  
%% Requirements 
% This function requires a set of Matlab tools and a Bedmachine dataset, 
% and both will depend on where you're working. Get them here:  
%
% * *For Greenland:*  
%
% # <https://www.mathworks.com/matlabcentral/fileexchange/63324 Arctic Mapping Tools> 
% # <https://nsidc.org/data/IDBMG4 Greenland Bedmachine Data> 
% 
% * *For Antarctica:* 
%
% # <https://www.mathworks.com/matlabcentral/fileexchange/47638 Antarctic Mapping Tools> 
% # <https://nsidc.org/data/nsidc-0756 Antarctic Bedmachine Data>
% 
%% Syntax 
% 
%  Z = bedmachine_data(variable)
%  Z = bedmachine_data(variable,lati,loni)
%  Z = bedmachine_data(variable,xi,yi) 
%  Z = bedmachine_data(...,'buffer',extrakm)
%  Z = bedmachine_data(...,IceSheet) 
%  Z = bedmachine_data(...,'datum',datum) 
%  [Z,x,y] = bedmachine_data(...) 
%  [Z,Lat,Lon] = bedmachine_data(...,'geo')
%  [~,x,y] = bedmachine_data(outline)
%  [~,lat,lon] = bedmachine_data(outline,'geo')
% 
%% Description 
% 
% |Z = bedmachine_data(variable)| loads a specified variable for the whole ice sheet, 
% with elevations relative to the EIGEN-EC4 geoid. The |variable| can be: 
%
% * |'mask'|      0 = ocean, 1 = ice-free land, 2 = grounded ice, 3 = floating ice, 4 = non-Greenland land
% * |'surface'|   meters relative to EIGEN-EC4 geoid.
% * |'thickness'| meters
% * |'bed'|       meters relative to EIGEN-EC4 geoid.
% * |'errbed'|    meters 
% * |'source'|    Greenland: 0 = none, 1 = gimpdem, 2 = Mass conservation, 3 = synthetic, 4 = interpolation, 5 = hydrostatic equilibrium, 6 = kriging, 7 = RTOPO-2, 8 = gravity inversion, 10+ = bathymetry data)
% * |'source'|    Antarctic: 1 = REMA/IBCSO, 2 = Mass conservation, 3 = interpolation, 4 = hydrostatic, 5 = Kriging, 6 = gravity inversion
% * |'geoid'|     meters above WGS84 ellipsoid
% * |'base'|      meters base of the ice sheet (bottom of ice shelves, but same as bed over grounded ice.) 
% * |'wct'|       meters water column thickness (derived, not an official BedMachine product.) 
% * |'taf'|       meters thickness above flotation (derived, not an official BedMachine product.) 
% * |'flex'|      dimensionless coefficient of tidal flexure (can slightly exceed 1; see Vaughan 1995 or Holdsworth 1969; derived, not an official BedMachine product; Requires Image Processing Toolbox. ) 
% * |'head'|      meters freshwater equivalent, static pressure head (derived, not an official BedMachine product.)    
%
% |Z = bedmachine_data(variable,lati,loni)| returns only enough BedMachine data to fully
% encompass a set of points given by geo coordinates |lati,loni|. This is a
% good way to save computer memory, only loading, analyzing, and plotting the
% data you need to work in a region of interest. 
% 
% |Z = bedmachine_data(variable,xi,yi)| As above, but for polar stereographic coordinates
% |xi,yi| in meters (ps70 for Greenland; ps71 for Antarctica). The function automatically 
% determines whether input coordinates are geo or polar stereographic via the |islatlon| function. 
% 
% |Z = bedmachine_data(...,'buffer',extrakm)| as above, but adds a buffer around the input
% coordinates. This option is useful for loading only the data in your region
% of interest, plus a little extra around the sides for good measure. 
% 
% |Z = bedmachine_data(...,IceSheet)| specifies either |'greenland'| 
% or |'antarctica'| (default). 
% 
% |Z = bedmachine_data(...,'datum',datum)| specifies a datum as either |'geoid'| (default) 
% or |'ellipsoid'| for wgs84. 
% 
% |[Z,x,y] = bedmachine_data(...,'xy')| returns polar stereographic meters (ps70 for
% Greenland; ps71 for Antarctica) as 1d arrays x,y. 
% 
% |[Z,Lat,Lon] = bedmachine_data(...,'geo')| returns gridded geo coordinates corresponding to 
% each pixel in |Z|. 
% 
% |[x,y] = bedmachine_data(outline)| gives the (derived) polar stereographic coordinates of 
% any of these outlines: 
% 
% * |'gl'|      grounding line
% * |'coast'|   coast line
% * |'hl'|      approximate hydrostatic line given by flex=0.99. 
% 
% |[lat,lon] = bedmachine_data(outline,'geo')| as above, but returns geographic 
% coordinates. 
% 
%% Example 1: Simplest case
% The simplest way to load BedMachine data is to just specify which variable
% you want to load, like this:

bed = bedmachine_data('bed'); 
imagesc(bed);  

%% Example 2: Making the full continent manageable
% But of course you'll want to know where those points belong on the map
% so get the polar stereographic coordinates like this: 

[bed,x,y] = bedmachine_data('bed','greenland'); 

%% 
% You may find that the full continent of data at the native 500 m resolution
% is rather unwieldy to work with. Simply loading the nearly 200 million data 
% points takes several seconds on my ancient laptop. 
% 
% If you're making a map of the whole continent, keep in mind that Greenland's 18,000 by 
% 10,000 points is more pixels than can possibly be displayed on any modern 
% computer screen, so we can probably do just fine if we scale down the full
% dataset by a factor of 10, and still get a high-res image of the ice sheet.
% 
% To downscale the dataset I recommend |imresize|, which is a standard Matlab 
% function and it performs antialiasing before downscaling. Here's what it
% looks like if we downscale the whole continent by a factor of 10. Instead 
% of the default parula colormap I'm using <https://www.mathworks.com/matlabcentral/fileexchange/68546 
% Fabio Crameri's topographic colormap>, which is perceptually uniform and draws a clear distinction
% between regions above and below sea level. 

sc = 0.1; % scale for resizing the grid
imagesc(imresize(x,sc),imresize(y,sc),imresize(bed,sc))
axis xy image off
caxis([-1 1]*2500)
cmocean topo
greenland('k') % adds a black grounding line

%% 
% Add a little relief shading if you like: 

shadem(3,[225 80])

%% Example: Jakobshavn Glacier: 
% The BedMachine datasets are quite large. The Greenland and Antarctic datasets each 
% have about 200 million grid cells. If you're focused on a small region you'll find
% it's much faster and uses much less computer memory if you only load the data you 
% need. Here we'll load all the data around Jakobshavn Glacier. 
%
% Jakobshavn Glacier is located at (69.167 N,49.833 W). Load all the Bedmachine
% data centered on that location, plus 75 km of data on each side and 150 km of 
% data on top and bottom, to make a final grid size of 150 km by 300 km: 

[Z,Lat,Lon] = bedmachine_data('surface',69.167,-49.833,'buffer',[75 150],'geo');

figure
pcolorpsn(Lat,Lon,Z) 
axis tight
scalebarpsn('location','se')
textpsn(69.167,-49.833,'Jakobshavn Gl.','fontangle','italic')
shadem(2,[225 60]) % applies hillshade
mapzoompsn('ne')   % creates an inset map
[C,h] = contourpsn(Lat,Lon,Z,'color',.5*[1 1 1]); % adds contour lines
clabel(C,h,'labelspacing',1e3,'color',.3*[1 1 1],'fontsize',8)

%% 
% Sometimes your region of interest is best defined by where you have data.
% For example, you're interested in the ice basin that drains through
% Moscow University Ice Shelf. Load the Moscow basin data using 
% <https://www.mathworks.com/matlabcentral/fileexchange/60246 |antbounds_data|>. 

[lat,lon] = basin_data('imbie refined','Moscow'); 

figure
plotps(lat,lon,'r')

%% 
% Now for whatever type of analysis you're doing, perhaps you decide you 
% just want all the bed elevation data in the Moscow ice basin, plus about 
% 25 km on all sides for good measure. Here's how to load just enough data
% to encompass your |lat,lon| dataset (the basin boundaries in this case) and
% add a 25 km buffer around it: 

[bed,x,y] = bedmachine_data('bed',lat,lon,'antarctica',...
   'buffer',25,'datum','ellipsoid'); 

imagesc(x,y,bed)
axis xy image % orients axis correctly & removes whitespace
hold on
plotps(lat,lon,'r') % plots basin outline 
cb = colorbar; 
ylabel(cb,'bed elevation (m wrt WGS84)')
mapzoomps('sw') 
caxis([-2200 1000])

%% 
% Now that's the bed elevation data with respect to WGS84 and it looks 
% decent. However, I'd like to point out what can be learned by playing 
% with hillshade. With any gridded dataset, I always recommend calling 
% |shadem('ui')|, which starts a user interface, letting you click around
% on the map to change light angles, or press up the up and down keys to 
% change the exaggeration of the effect. Here are some |shadem| settings
% that look okay for this map. Also I'm gonna set the colormap to the 
% |cmocean| topographic color scheme, using the |'pivot'| option to 
% ensure the zero point is at zero elevation. 

shadem(2,[225 80]) 
cmocean('topo','pivot') 

%% 
% In the map above, you might notice some interesting features that appear 
% after adding |shadem|. Note the pearl-necklace patterns that radiate outward
% from Casey Station (beyond the right edge of the map). Those patterns are 
% instantly recognizable as a gridding effect that results when survey flight
% lines are sparse. The surface may be locally overfit close to the flight lines, but 
% the large smooth areas between flight lines get smeared out because no data
% are available to constrain the gridding. 
% 
% The necklace effects we see in the map above do not indicate that anything 
% went wrong with the gridding process, but do give you an idea of where we 
% actually have ice thickness data, and where things have been filled in by 
% interpolation. 
% 
% Now, just as a fun exercise, let's load BedMachine surface data and plot it
% as contour lines every 500 m, but only plot contours within the bounds of 
% the Moscow University Ice Shelf basin. We'll also do someting slightly different
% to load the data this timeREPLACE_WITH_DASH_DASHinstead of entering the geo coordinates of 
% the basin outline and specifying a buffer distance, we can just load 
% enough data to fill the axis limits of the map above, using |xlim| and |ylim|. 
% Here's how: 

% Load surface data: 
[sfz,LAT,LON] = bedmachine_data('surface',xlim,ylim,'antarctica',...
   'datum','ellipsoid','geo'); 

% Mask out surface data outside the basin: 
sfz(~inbasin(LAT,LON,'imbie refined','moscow')) = nan; 

% Plot and label contour lines: 
[C,h] = contourps(LAT,LON,sfz,0:500:10000,'k'); 
clabel(C,h,'labelspacing',1e3)
caxis([-2200 1000])

%% Citing this dataset
% If you use BedMachine data, please cite the Morlighem paper listed below. 
% And if this function is useful for you, please do me a kindness and cite 
% my Antarctic Mapping Tools paper. 
% 
% Morlighem M. et al., (2017), BedMachine v3: Complete bed topography and ocean 
% bathymetry mapping of Greenland from multi-beam echo sounding combined with
% mass conservation, _Geophys. Res. Lett._, 44, <http://doi.org/10.1002/2017GL074954 
% doi:10.1002/2017GL074954>. 
% 
% Morlighem, M., E. Rignot, T. Binder, D. D. Blankenship, R. Drews, G. Eagles,
% O. Eisen, F. Ferraccioli, R. Forsberg, P. Fretwell, V. Goel, J. S. Greenbaum, H. 
% Gudmundsson, J. Guo, V. Helm, C. Hofstede, I. Howat, A. Humbert, W. Jokat, N. B. 
% Karlsson, W. Lee, K. Matsuoka, R. Millan, J. Mouginot, J. Paden, F. Pattyn, J. L. Roberts,
% S. Rosier, A. Ruppel, H. Seroussi, E. C. Smith, D. Steinhage, B. Sun, M. R. van den Broeke, 
% T. van Ommen, M. van Wessem, and D. A. Young. 2019. Deep glacial troughs and stabilizing 
% ridges unveiled beneath the margins of the Antarctic ice sheet, Nature Geoscience.
% <https://doi.org/10.1038/s41561-019-0510-8 doi:10.1016/j.cageo.2016.08.003>.
%
% Greene, C. A., Gwyther, D. E., & Blankenship, D. D. Antarctic Mapping Tools  
% for Matlab. _Computers & Geosciences_. 104 (2017) pp.151-157. 
% <http://dx.doi.org/10.1016/j.cageo.2016.08.003 doi:10.1016/j.cageo.2016.08.003>.
% 
%% Author Info
% This function and supporting documentation were written by Chad A. Greene
% of the University of Texas at Austin, October 2018. 

##### SOURCE END #####
--></body></html>